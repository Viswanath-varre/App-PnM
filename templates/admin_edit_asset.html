{% extends 'admin_base.html' %}
{% block title %}Edit Asset{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto p-6 bg-white rounded shadow">
  <h1 class="text-2xl font-bold mb-6">Edit Asset</h1>

  <form id="editAssetForm" class="grid grid-cols-2 gap-4">
    <!-- Row 1 -->
    <div>
      <label class="block text-sm">Asset Code</label>
      <input name="asset_code" value="{{ asset.asset_code or '' }}" class="w-full border rounded px-3 py-2" required>
    </div>
    <div>
      <label class="block text-sm">Asset Description</label>
      <input name="asset_description" value="{{ asset.asset_description or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 2 -->
    <div>
      <label class="block text-sm">Reg. No.</label>
      <input name="reg_no" value="{{ asset.reg_no or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Package</label>
      <input name="package" value="{{ asset.package or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 3 -->
    <div>
      <label class="block text-sm">Activity</label>
      <input name="activity" value="{{ asset.activity or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Location</label>
      <input name="location" value="{{ asset.location or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 4 -->
    <div>
      <label class="block text-sm">Meter Type</label>
      <input name="meter_type" value="{{ asset.meter_type or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">UoM</label>
      <input name="uom" value="{{ asset.uom or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 5 -->
    <div>
      <label class="block text-sm">Fuel Norms</label>
      <input name="fuel_norms" value="{{ asset.fuel_norms or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Owner</label>
      <select name="owner" class="w-full border rounded px-3 py-2">
        <option value="" {% if not asset.owner %}selected{% endif %}>-- Select --</option>
        <option value="Own" {% if asset.owner == 'Own' %}selected{% endif %}>Own</option>
        <option value="Hire" {% if asset.owner == 'Hire' %}selected{% endif %}>Hire</option>
        <option value="NC" {% if asset.owner == 'NC' %}selected{% endif %}>NC</option>
      </select>
    </div>

    <!-- Row 6 -->
    <div>
      <label class="block text-sm">Vendor Code</label>
      <input name="vendor_code" value="{{ asset.vendor_code or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Agency</label>
      <input name="agency" value="{{ asset.agency or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 7 -->
    <div>
      <label class="block text-sm">WOD Number</label>
      <input name="wod_number" value="{{ asset.wod_number or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Vendor Mail Id</label>
      <input type="email" name="vendor_mail_id" value="{{ asset.vendor_mail_id or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 8 -->
    <div>
      <label class="block text-sm">Date of Commission</label>
      <input type="date" name="date_of_commission" value="{{ asset.date_of_commission or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Starting Reading</label>
      <input type="number" name="starting_reading" value="{{ asset.starting_reading or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 9 -->
    <div>
      <label class="block text-sm">Tank Capacity</label>
      <input type="number" name="tank_capacity" value="{{ asset.tank_capacity or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">HSD Available</label>
      <input type="number" name="hsd_available" value="{{ asset.hsd_available or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 10 -->
    <div>
      <label class="block text-sm">Make</label>
      <input name="make" value="{{ asset.make or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Model</label>
      <input name="model" value="{{ asset.model or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 11 -->
    <div>
      <label class="block text-sm">PM Make</label>
      <input name="pm_make" value="{{ asset.pm_make or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">PM Model</label>
      <input name="pm_model" value="{{ asset.pm_model or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 12 -->
    <div>
      <label class="block text-sm">EHC</label>
      <input type="number" name="ehc" value="{{ asset.ehc or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">IHC</label>
      <input type="number" name="ihc" value="{{ asset.ihc or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 13 -->
    <div>
      <label class="block text-sm">Additional Operator Charge</label>
      <input type="number" name="additional_operator_charge" value="{{ asset.additional_operator_charge or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Shift Hours</label>
      <input type="number" name="shift_hours" value="{{ asset.shift_hours or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 14 -->
    <div>
      <label class="block text-sm">Operators Available</label>
      <input type="number" name="operator_available" value="{{ asset.operator_available or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Helpers Available</label>
      <input type="number" name="helper_available" value="{{ asset.helper_available or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 15 -->
    <div>
      <label class="block text-sm">Supervisor/Owner Name</label>
      <input name="supervisor_owner_name" value="{{ asset.supervisor_owner_name or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Supervisor/Owner Phone</label>
      <input name="supervisor_owner_phone" value="{{ asset.supervisor_owner_phone or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 16 -->
    <div>
      <label class="block text-sm">Operator 1</label>
      <input name="operator1" value="{{ asset.operator1 or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Operator 1 Phone</label>
      <input name="operator1_phone" value="{{ asset.operator1_phone or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 17 -->
    <div>
      <label class="block text-sm">Operator 1 Shift</label>
      <input name="operator1_shift" value="{{ asset.operator1_shift or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Operator 2</label>
      <input name="operator2" value="{{ asset.operator2 or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Row 18 -->
    <div>
      <label class="block text-sm">Operator 2 Phone</label>
      <input name="operator2_phone" value="{{ asset.operator2_phone or '' }}" class="w-full border rounded px-3 py-2">
    </div>
    <div>
      <label class="block text-sm">Operator 2 Shift</label>
      <input name="operator2_shift" value="{{ asset.operator2_shift or '' }}" class="w-full border rounded px-3 py-2">
    </div>

    <!-- Submit -->
    <div class="col-span-2 flex justify-end space-x-3 mt-6">
      <a href="/admin_asset_master" class="px-4 py-2 rounded border">Cancel</a>
      <button type="submit" class="px-4 py-2 rounded bg-yellow-custom text-black">Update</button>
    </div>
  </form>
</div>

<script>
  document.getElementById("editAssetForm").addEventListener("submit", async function(e){
    e.preventDefault();
    const form = e.target;
    const data = Object.fromEntries(new FormData(form).entries());

    // Convert numeric fields
    ["starting_reading","tank_capacity","hsd_available","ehc","ihc",
     "additional_operator_charge","shift_hours",
     "operator_available","helper_available"].forEach(f=>{
      if(data[f] !== undefined && data[f] !== "") data[f] = parseFloat(data[f]);
      else data[f] = null;
    });

    try {
      const r = await fetch("/update_asset/{{ asset.id }}", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
      });
      const resp = await r.json();
      if(r.status === 200 && resp.success){
        window.location.href = "/admin_asset_master";
      } else {
        alert("Failed to update asset: " + (resp.error || JSON.stringify(resp)));
      }
    } catch(err) {
      alert("Error: " + err);
    }
  });
</script>
{% endblock %}
