<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% block title %}MABP {{ session['name'] }}{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'yellow-custom': '#FFD700',
            'yellow-light': '#FFF8DC',
            'black-custom': '#1a1a1a',
            'gray-custom': '#2d2d2d'
          }
        }
      }
    }
  </script>
  <style>
    html, body { overflow-x: hidden; }

    .gradient-bg { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); }
    .sidebar-gradient { background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 100%); }
    .header-gradient { background: linear-gradient(90deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%); }

    /* Sidebar */
    .sidebar { 
      width: 280px; 
      height: 100vh; 
      position: fixed; 
      left: 0; 
      top: 0; 
      z-index: 40; 
      overflow-y: auto; 
      transform: translateX(0);
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); 
    }
    .sidebar.hidden { transform: translateX(-280px); }

    .sidebar-link { display: flex; align-items: center; padding: 14px 18px; color: #e5e7eb; text-decoration: none; transition: all 0.3s ease; border-left: 4px solid transparent; }
    .sidebar-link:hover { background: rgba(255, 215, 0, 0.1); color: #FFD700; border-left-color: #FFD700; transform: translateX(6px); }
    .sidebar-link.active { background: rgba(255, 215, 0, 0.15); color: #FFD700; border-left-color: #FFD700; }

    /* Main content */
    .main-content { 
      margin-left: 280px; 
      padding: 120px 40px 40px 40px; 
      transition: margin-left 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
    }
    .main-content.sidebar-hidden { margin-left: 0; opacity: 0.95; }

    /* Header */
    .header { 
      height: 80px; 
      box-shadow: 0 2px 10px rgba(255,215,0,0.1); 
      position: fixed; 
      top: 0; 
      left: 280px; 
      right: 0; 
      z-index: 30; 
      transition: left 0.5s cubic-bezier(0.4, 0, 0.2, 1); 
    }
    .header.sidebar-hidden { left: 0; }

    /* Mobile Menu Button */
    .menu-btn { display: none; position: fixed; top: 20px; left: 20px; z-index: 50; background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); border-radius: 8px; padding: 10px; cursor: pointer; transition: all 0.3s ease; }
    .menu-btn span { display: block; width: 22px; height: 3px; background: #1a1a1a; margin: 4px 0; border-radius: 2px; transition: 0.3s; }
    .menu-btn.active span:nth-child(1) { transform: rotate(-45deg) translate(-5px, 6px); }
    .menu-btn.active span:nth-child(2) { opacity: 0; }
    .menu-btn.active span:nth-child(3) { transform: rotate(45deg) translate(-5px, -6px); }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      .sidebar { transform: translateX(-280px); }
      .sidebar.open { transform: translateX(0); }
      .main-content { margin-left: 0; padding: 110px 20px 30px 20px; }
      .header { left: 0; }
      .menu-btn { display: block; }
    }

    /* Animations */
    .fade-in { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .pulse-glow { animation: pulseGlow 2s ease-in-out infinite; }
    @keyframes pulseGlow { 0%,100%{box-shadow:0 0 10px rgba(255,215,0,.3);} 50%{box-shadow:0 0 20px rgba(255,215,0,.5);} }

    /* Overlay for mobile */
    .overlay { display: none; position: fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:35; }
    .overlay.active { display: block; }
  </style>
</head>
<body class="bg-gray-100">

  <!-- Mobile Menu Button -->
  <button class="menu-btn" id="menuBtn" onclick="toggleSidebar()">
    <span></span><span></span><span></span>
  </button>

  <!-- Overlay -->
  <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

  <!-- Sidebar -->
  <div class="sidebar sidebar-gradient flex flex-col" id="sidebar">
    <!-- Sidebar Header -->
    <div class="p-6 border-b border-gray-600">
      <div class="flex items-center space-x-3">
        <div class="w-12 h-12 gradient-bg rounded-lg flex items-center justify-center pulse-glow">
          <!-- Crane Icon -->
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
            <rect x="11" y="2" width="2" height="18" fill="#1a1a1a" stroke="#333" stroke-width="0.5"/>
            <rect x="4" y="5" width="16" height="1.5" fill="#1a1a1a" stroke="#333" stroke-width="0.5"/>
            <rect x="2" y="5" width="4" height="1" fill="#1a1a1a" stroke="#333" stroke-width="0.5"/>
            <rect x="1" y="4" width="2" height="3" fill="#2a2a2a" stroke="#444" stroke-width="0.5"/>
            <rect x="10" y="6" width="4" height="2" fill="#2a2a2a" stroke="#444" stroke-width="0.5" rx="0.5"/>
            <rect x="10.5" y="6.3" width="1" height="1" fill="#444" stroke="#666" stroke-width="0.2"/>
            <rect x="12.5" y="6.3" width="1" height="1" fill="#444" stroke="#666" stroke-width="0.2"/>
            <line x1="18" y1="6.5" x2="18" y2="15" stroke="#333" stroke-width="0.8" stroke-dasharray="0.5,0.5"/>
            <rect x="16.5" y="16" width="3" height="2" fill="#444" stroke="#666" stroke-width="0.4" rx="0.3"/>
            <rect x="8" y="20" width="8" height="2" fill="#2a2a2a" stroke="#444" stroke-width="0.5"/>
          </svg>
        </div>
        <div>
          <h2 class="text-xl font-bold text-yellow-custom">MABP</h2>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="mt-4 px-2">
      <a href="/user_dashboard" class="sidebar-link">Dashboard</a>
      {% for m in session['accesses'] %}
        {% if m == 'asset_master' %}
          <a href="/user_asset_master" class="sidebar-link">Asset Master</a>
        {% elif m == 'break_down_report' %}
          <a href="/user_breakdown_report" class="sidebar-link">Break Down Report</a>
        {% elif m == 'docments_status' %}
          <a href="/user_asset_documents_status" class="sidebar-link">RTO/TPI Docments</a>
        {% elif m == 'fuel_consumption_analysis' %}
          <a href="/user_fuel_consumption_analysis" class="sidebar-link">Fuel Consumption Analysis/a>
        {% elif m == 'asset_running_status' %}
          <a href="/user_asset_running_status" class="sidebar-link">Asset Running</a>
        {% elif m == 'spares_requirements' %}
          <a href="/user_spares_requirements" class="sidebar-link">Spares Requirement</a>
        {% elif m == 'maintenance_schedule' %}
          <a href="/user_maintenance_schedule" class="sidebar-link">Maintenance Schedule</a>
        {% elif m == 'digital_status' %}
          <a href="/user_digital_status" class="sidebar-link">Digital Status</a>
        {% elif m == 'green_card_status' %}
          <a href="/user_green_card_status" class="sidebar-link">Green Card</a>
        {% elif m == 'uauc_status' %}
          <a href="/user_uauc_status" class="sidebar-link">UA/UC Status</a>
        {% elif m == 'daywise_works' %}
          <a href="/user_daywise_works" class="sidebar-link">Daywise Works</a>
        {% elif m == 'hire_billing_status' %}
          <a href="/user_hire_billing_status" class="sidebar-link">Hire Billing</a>
        {% elif m == 'concrete_production' %}
          <a href="/user_concrete_production" class="sidebar-link">Concrete Production</a>
        {% elif m == 'solar_report' %}
          <a href="/user_solar_report" class="sidebar-link">Solar Report</a>
        {% elif m == 'workmen_status' %}
          <a href="/user_workmen_status" class="sidebar-link">Workmen Status</a>
        {% endif %}
      {% endfor %}
    </nav>

    <!-- Logout -->
    <div class="mt-auto px-2 pb-6">
      <a href="/logout" class="sidebar-link bg-red-600 hover:bg-red-700 rounded-lg">Logout</a>
    </div>
  </div>

  <!-- Header -->
  <header class="header header-gradient" id="header">
    <div class="flex items-center justify-between h-full px-4 sm:px-6">
      
      <!-- Desktop Toggle Button -->
      <button class="hidden md:block mr-4" onclick="toggleSidebar()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-custom" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

      <!-- Left: Title -->
      <div class="hidden sm:block">
        <h1 class="text-xl font-bold text-yellow-custom">P&M</h1>
        <p class="text-sm text-gray-300">Plant & Machinery Data Management System</p>
      </div>

      <!-- Center: Welcome -->
      <div class="flex flex-col items-center text-center flex-grow mx-2">
        <p class="text-yellow-custom font-semibold text-sm sm:text-base">Welcome</p>
        <p class="text-white text-xs sm:text-sm truncate max-w-[120px] sm:max-w-none">{{ session['name'] }}</p>
      </div>

      <!-- Right: Profile -->
      <div class="flex items-center space-x-4">
        <div class="relative">
          <button id="userMenuBtn" class="w-8 h-8 bg-yellow-custom rounded-full flex items-center justify-center">
            <svg class="w-5 h-5 text-black" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
            </svg>
          </button>
          <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white border rounded-lg shadow-lg z-50">
            <a href="/user_profile" class="block px-4 py-2 text-sm hover:bg-gray-100">View Profile</a>
            <a href="/change_password" class="block px-4 py-2 text-sm hover:bg-gray-100">Change Password</a>
            <a href="/logout" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Logout</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content bg-gray-50" id="mainContent">
    <div class="fade-in">
      {% block content %}{% endblock %}
    </div>
  </main>

  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.getElementById('mainContent');
      const header = document.getElementById('header');
      const menuBtn = document.getElementById('menuBtn');
      const overlay = document.getElementById('overlay');

      if (window.innerWidth <= 768) {
        sidebar.classList.toggle('open');
        menuBtn.classList.toggle('active');
        overlay.classList.toggle('active');
      } else {
        sidebar.classList.toggle('hidden');
        mainContent.classList.toggle('sidebar-hidden');
        header.classList.toggle('sidebar-hidden');
      }
    }
    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('menuBtn').classList.remove('active');
      document.getElementById('overlay').classList.remove('active');
    }
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('userMenuBtn');
      const dropdown = document.getElementById('userDropdown');
      if (btn && dropdown) {
        btn.addEventListener('click', e => {
          e.stopPropagation(); dropdown.classList.toggle('hidden');
        });
        document.addEventListener('click', e => {
          if (!btn.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.classList.add('hidden');
          }
        });
      }
    });
    // Highlight active link
    const currentPath = window.location.pathname;
    document.querySelectorAll('.sidebar-link').forEach(link => {
      if (link.getAttribute('href') === currentPath) link.classList.add('active');
    });
  </script>
</body>
</html>
